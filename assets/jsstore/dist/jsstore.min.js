/*!
 * @license :jsstore - V3.3.3 - 03/09/2019
 * https://github.com/ujjwalguptaofficial/JsStore
 * Copyright (c) 2019 @Ujjwal Gupta; Licensed MIT
 */
var JsStore=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";var r,i,o,u,s;n.r(t),function(e){e.WorkerNotSupplied="worker_not_supplied",e.IndexedDbUndefined="indexeddb_undefined"}(r||(r={})),function(e){e.Registered="registerd",e.Failed="failed",e.NotStarted="not_started"}(i||(i={})),function(e){e.String="string",e.Object="object",e.Array="array",e.Number="number",e.Boolean="boolean",e.Null="null",e.DateTime="date_time"}(o||(o={})),function(e){e.InitDb="init_db",e.IsDbExist="is_db_exist",e.GetDbVersion="get_db_version",e.GetDbList="get_db_list",e.Get="get",e.Set="set",e.Select="select",e.Insert="insert",e.Update="update",e.Remove="remove",e.GetDbSchema="get_db_schema",e.OpenDb="open_db",e.Clear="clear",e.DropDb="drop_db",e.Count="count",e.BulkInsert="bulk_insert",e.ChangeLogStatus="change_log_status",e.Terminate="terminate",e.Transaction="transaction",e.InitKeyStore="init_keystore",e.CloseDb="close_db"}(u||(u={})),function(e){e.RequestQueueEmpty="requestQueueEmpty",e.RequestQueueFilled="requestQueueFilled"}(s||(s={}));var c,p=function(){function e(){}return e.isLogEnabled=!1,e.isRuningInWorker=!0,e}(),a=function(){function e(e,t){void 0===t&&(t=null),this.type=e,this._info=t,this.message=this.getMsg()}return e.prototype.throw=function(){throw this.get()},e.log=function(e){p.isLogEnabled&&console.log(e)},e.prototype.logError=function(){console.error(this.get())},e.prototype.logWarning=function(){console.warn(this.get())},e.prototype.get=function(){return{message:this.message,type:this.type}},e.prototype.getMsg=function(){var e;switch(this.type){case r.WorkerNotSupplied:e="Worker object is not passed in instance constructor";break;case r.IndexedDbUndefined:e="Browser does not support indexeddb";break;default:e=this.message}return e},e}(),f=function(){function e(e){this.isDbOpened_=!1,this.isDbIdle_=!0,this.requestQueue_=[],this.isCodeExecuting_=!1,this.inactivityTimer_=-1e3,this.eventQueue=[],this.whiteListApi_=[u.InitDb,u.IsDbExist,u.GetDbVersion,u.GetDbList,u.OpenDb,u.GetDbSchema,u.Get,u.Set,u.ChangeLogStatus,u.Terminate,u.InitKeyStore],e?(this.worker_=e,this.worker_.onmessage=this.onMessageFromWorker_.bind(this)):p.isRuningInWorker=!1}return e.prototype.initKeyStore_=function(){p.isRuningInWorker?this.prcoessExecutionOfQry_({name:u.InitKeyStore,onSuccess:function(){},onError:function(e){console.error(e)}},0):JsStoreWorker.KeyStore.init()},e.prototype.onMessageFromWorker_=function(e){this.processFinishedQuery_(e.data)},e.prototype.processFinishedQuery_=function(e){var t=this.requestQueue_.shift();if(t){if(a.log("request "+t.name+" finished"),e.errorOccured)t.onError(e.errorDetails);else{switch(t.name){case u.OpenDb:case u.InitDb:this.isDbOpened_=!0;break;case u.Terminate:this.isDbOpened_=!1,!0===p.isRuningInWorker&&this.worker_.terminate();break;case u.CloseDb:this.requestQueue_.length>0?this.openDb_():(this.isDbIdle_=!0,this.callEvent(s.RequestQueueEmpty,[]))}t.onSuccess(e.returnedValue)}this.isCodeExecuting_=!1,this.executeQry_()}},e.prototype.openDb_=function(){this.initKeyStore_(),this.prcoessExecutionOfQry_({name:u.OpenDb,query:this.activeDbName,onSuccess:function(){},onError:function(e){console.error(e)}},1)},e.prototype.pushApi=function(e){var t=this;return new Promise(function(n,r){e.onSuccess=function(e){n(e)},e.onError=function(e){r(e)},0===t.requestQueue_.length&&(t.callEvent(s.RequestQueueFilled,[]),!0===t.isDbIdle_&&!0===t.isDbOpened_?t.openDb_():(clearTimeout(t.inactivityTimer_),t.initKeyStore_())),t.prcoessExecutionOfQry_(e)})},e.prototype.prcoessExecutionOfQry_=function(e,t){this.isDbIdle_=!1,null!=t?this.requestQueue_.splice(t,0,e):this.requestQueue_.push(e),a.log("request pushed: "+e.name),this.executeQry_()},e.prototype.executeQry_=function(){var e=this,t=this.requestQueue_.length;if(!this.isCodeExecuting_&&t>0){if(!0===this.isDbOpened_)return void this.sendRequestToWorker_(this.requestQueue_[0]);var n=this.requestQueue_.findIndex(function(t){return e.whiteListApi_.indexOf(t.name)>=0});n>=0&&(this.requestQueue_.splice(0,0,this.requestQueue_.splice(n,1)[0]),this.sendRequestToWorker_(this.requestQueue_[0]))}else 0===t&&!1===this.isDbIdle_&&this.isDbOpened_&&(this.inactivityTimer_=setTimeout(function(){e.prcoessExecutionOfQry_({name:u.CloseDb,onSuccess:function(){},onError:function(e){console.error(e)}})},100))},e.prototype.sendRequestToWorker_=function(e){this.isCodeExecuting_=!0;var t={name:e.name,query:e.query};!0===p.isRuningInWorker?this.worker_.postMessage(t):new JsStoreWorker.QueryExecutor(this.processFinishedQuery_.bind(this)).checkConnectionAndExecuteLogic(t)},e.prototype.callEvent=function(e,t){this.eventQueue.filter(function(t){if(t.event===e)return t}).forEach(function(e){e.callback.apply(e,t)})},e}(),h=function(){function e(){}return Object.defineProperty(e,"sqlWeb",{get:function(){return null==e.sqlWeb_?self.SqlWeb:e.sqlWeb_},set:function(t){e.sqlWeb_=t},enumerable:!0,configurable:!0}),e}(),l=(c=function(e,t){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),d=function(e){function t(t){return e.call(this,t)||this}return l(t,e),t.prototype.openDb=function(e){return this.activeDbName=e,this.pushApi({name:u.OpenDb,query:e})},t.prototype.initDb=function(e){return this.activeDbName=e.name,this.pushApi({name:u.InitDb,query:e})},t.prototype.dropDb=function(){return this.pushApi({name:u.DropDb,query:null})},t.prototype.select=function(e){return this.pushApi({name:u.Select,query:e})},t.prototype.count=function(e){return this.pushApi({name:u.Count,query:e})},t.prototype.insert=function(e){return this.pushApi({name:u.Insert,query:e})},t.prototype.update=function(e){return this.pushApi({name:u.Update,query:e})},t.prototype.remove=function(e){return this.pushApi({name:u.Remove,query:e})},t.prototype.clear=function(e){return this.pushApi({name:u.Clear,query:e})},t.prototype.bulkInsert=function(e){return this.pushApi({name:u.BulkInsert,query:e})},t.prototype.setLogStatus=function(e){p.isLogEnabled=e||p.isLogEnabled,this.pushApi({name:u.ChangeLogStatus,query:p.isLogEnabled})},t.prototype.getDbVersion=function(e){return this.pushApi({name:u.GetDbVersion,query:e})},t.prototype.isDbExist=function(e){return this.pushApi({name:u.IsDbExist,query:e})},t.prototype.getDbList=function(){return this.pushApi({name:u.GetDbList,query:null})},t.prototype.getDbSchema=function(e){return this.pushApi({name:u.GetDbSchema,query:e})},t.prototype.get=function(e){return this.pushApi({name:u.Get,query:e})},t.prototype.set=function(e,t){return this.pushApi({name:u.Set,query:{key:e,value:t}})},t.prototype.terminate=function(){return this.pushApi({name:u.Terminate,query:null})},t.prototype.transaction=function(e){return!0===p.isRuningInWorker&&(e.logic=e.logic.toString()),this.pushApi({name:u.Transaction,query:e})},t.prototype.runSql=function(e){var t=h.sqlWeb.parseSql(e);return this[t.api](t.data)},t.prototype.on=function(e,t){this.eventQueue.push({event:e,callback:t})},t.prototype.off=function(e,t){var n=this;this.eventQueue.map(function(t,n){if(t.event===e)return n}).forEach(function(e){n.eventQueue.splice(e,0)})},t}(f),b=function(){p.isLogEnabled=!0},y=function(e){h.sqlWeb=e};n.d(t,"Instance",function(){return d}),n.d(t,"ERROR_TYPE",function(){return r}),n.d(t,"WORKER_STATUS",function(){return i}),n.d(t,"DATA_TYPE",function(){return o}),n.d(t,"API",function(){return u}),n.d(t,"EVENT",function(){return s}),n.d(t,"Config",function(){return p}),n.d(t,"enableLog",function(){return b}),n.d(t,"useSqlWeb",function(){return y})}]);